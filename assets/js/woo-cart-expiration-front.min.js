function triggerCartPolling(e){var o={action:"woo_cart_expiration_timer",nonce:wooCartExpiration.timer_nonce};jQuery.post(wooCartExpiration.ajaxurl,o,function(e){!0!==e.success&&"true"!==e.success&&(!1!==e.success&&"false"!==e.success||destroyAllEvidence())},"json")}function displayTimerMarkup(o){var e={action:"woo_cart_get_timer_markup",nonce:wooCartExpiration.markup_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&""!==e.data.markup&&(removeExistingTimer(),jQuery("body").append(e.data.markup),jQuery("head").append('<meta name="woo-cart-expiration" content="'+parseInt(wooCartExpiration.set_expired,10)+'" />'),loadCartTimer(o),jQuery("#woo-cart-expire-countdown").countdown({date:wooCartExpiration.set_expired,repeat:1e3}))},"json")}function maybeRemoveTimer(){var e={action:"woo_cart_check_remaining_count",nonce:wooCartExpiration.count_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&(!0!==e.data.empty||destroyAllEvidence())},"json")}function killTheCartContents(){var e={action:"woo_cart_clear_expired_cart",nonce:wooCartExpiration.killit_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&!0===e.data.cleared&&jQuery(document.body).trigger("wc_fragment_refresh")},"json")}function resetCookieAtCheckout(){var e={action:"woo_cart_reset_cookie_checkout",nonce:wooCartExpiration.reset_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&jQuery("#woo-cart-expire-countdown").countdown({date:wooCartExpiration.set_expired,repeat:1e3})},"json")}function loadCartTimer(e){window.cartPollID=setInterval(function(){triggerCartPolling()},parseInt(e,10))}function displayTimerValues(e,o){var r=Math.floor(jQuery.now()/1e3);if(parseInt(e,10)<=parseInt(r,10))destroyAllEvidence();else{var a=e-r;if(parseInt(a,10)<1)destroyAllEvidence();else{var t=a,i=Math.floor(t/60);0<i&&(t-=60*i),t=2<=String(t).length?t:"0"+t,o.find(".expire-minutes").text(i),o.find(".expire-seconds").text(t),setTimerDisplayClass(a)}}}function setTimerDisplayClass(e){var o=jQuery("#woo-cart-timer-wrap-id").find(".woo-cart-timer-radial"),r=[10,30,60,180,300];parseInt(e,10)<parseInt(r[0],10)?jQuery(".woo-cart-expire-modal-wrap").addClass("woo-cart-expire-modal-wrap-display"):parseInt(e,10)<parseInt(r[1],10)?(o.addClass("woo-cart-timer-radial-expire-full"),o.addClass("woo-cart-timer-radial-expire-pulse"),o.removeClass("woo-cart-radial-animate")):parseInt(e,10)<parseInt(r[2],10)?(o.removeClass("woo-cart-timer-radial-expire-closer"),o.removeClass("woo-cart-timer-radial-expire-warning"),o.addClass("woo-cart-timer-radial-expire-soon")):parseInt(e,10)<parseInt(r[3],10)?(o.removeClass("woo-cart-timer-radial-expire-closer"),o.addClass("woo-cart-timer-radial-expire-warning")):parseInt(e,10)<parseInt(r[4],10)&&o.addClass("woo-cart-timer-radial-expire-closer")}function destroyAllEvidence(){killAllIntervals(),killTheCartContents(),removeExistingTimer(),removeExistingModal(),document.cookie=wooCartExpiration.cookie_name+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}function killAllIntervals(){void 0!==window.cartPollID&&"undefined"!==window.cartPollID&&window.clearInterval(window.cartPollID),void 0!==window.cartTimeID&&"undefined"!==window.cartTimeID&&window.clearInterval(window.cartTimeID)}function removeExistingTimer(){var e=document.getElementById("woo-cart-timer-wrap-id");e&&e.remove()}function removeExistingModal(){var e=document.getElementById("woo-cart-expire-modal-wrap-id");e&&e.remove()}jQuery(document).ready(function(r){r.fn.countdown=function(e,o){timerBlock=r(this),t=e.date,expireInvl=e.repeat,displayTimerValues(t,timerBlock),window.cartTimeID=setInterval(function(){displayTimerValues(t,timerBlock)},parseInt(expireInvl,10))};var e=wooCartExpiration.maybe_check,a=wooCartExpiration.interval,t=0,o=document.querySelector('meta[name="woo-cart-expiration"]');o?(t=o.getAttribute("content"),loadCartTimer(a),jQuery("#woo-cart-expire-countdown").countdown({date:t,repeat:1e3})):killAllIntervals(),"checkout"===e&&resetCookieAtCheckout(),"order"===e&&maybeRemoveTimer(),r(document.body).on("added_to_cart",function(e,o,r){displayTimerMarkup(a)}),r(document.body).on("removed_from_cart",function(e){maybeRemoveTimer()}),r(".woo-cart-expire-modal-wrap").on("click",".woo-cart-expire-modal-close",function(e){r(".woo-cart-expire-modal-block").fadeOut("slow"),maybeRemoveTimer()})});