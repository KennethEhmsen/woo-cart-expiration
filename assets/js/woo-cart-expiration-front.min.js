function triggerCartPolling(e){var o={action:"woo_cart_expiration_timer",nonce:wooCartExpiration.timer_nonce};jQuery.post(wooCartExpiration.ajaxurl,o,function(e){if(!0!==e.success&&"true"!==e.success)return!1===e.success||"false"===e.success?(destroyAllEvidence(),jQuery(document.body).trigger("wc_fragment_refresh"),void jQuery(document.body).trigger("updated_wc_div")):void 0},"json")}function displayTimerMarkup(o){var e={action:"woo_cart_get_timer_markup",nonce:wooCartExpiration.markup_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&""!==e.data.markup&&(destroyAllEvidence(),jQuery("body").append(e.data.markup),loadCartTimer(o),jQuery("#woo-cart-expire-countdown").countdown({date:wooCartExpiration.set_expired,repeat:1e3}))},"json")}function maybeRemoveTimer(){var e={action:"woo_cart_check_remaining_count",nonce:wooCartExpiration.count_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&!0===e.data.empty&&destroyAllEvidence()},"json")}function resetCookieAtCheckout(){var e={action:"woo_cart_reset_cookie_checkout",nonce:wooCartExpiration.reset_nonce};jQuery.post(wooCartExpiration.ajaxurl,e,function(e){!1!==e.success&&"false"!==e.success&&jQuery("#woo-cart-expire-countdown").countdown({date:wooCartExpiration.set_expired,repeat:1e3})},"json")}function loadCartTimer(e){window.cartPollID=setInterval(function(){triggerCartPolling()},parseInt(e,10))}function displayTimerValues(e,o){var r=Math.floor(jQuery.now()/1e3);parseInt(e,10)<=parseInt(r,10)&&destroyAllEvidence();var t=e-r;parseInt(t,10)<0&&destroyAllEvidence();var a=t,i=Math.floor(a/60);0<i&&(a-=60*i),a=2<=String(a).length?a:"0"+a,o.find(".expire-minutes").text(i),o.find(".expire-seconds").text(a),setTimerDisplayClass(t)}function setTimerDisplayClass(e){var o=jQuery("#woo-cart-timer-wrap-id").find(".woo-cart-timer-radial"),r=[10,60,180,300];parseInt(e,10)<parseInt(r[0],10)?(o.addClass("woo-cart-timer-radial-expire-pulse"),displayExpireAlert()):parseInt(e,10)<parseInt(r[1],10)?(o.removeClass("woo-cart-timer-radial-expire-closer"),o.removeClass("woo-cart-timer-radial-expire-warning"),o.addClass("woo-cart-timer-radial-expire-soon")):parseInt(e,10)<parseInt(r[2],10)?(o.removeClass("woo-cart-timer-radial-expire-closer"),o.addClass("woo-cart-timer-radial-expire-warning")):parseInt(e,10)<parseInt(r[3],10)&&o.addClass("woo-cart-timer-radial-expire-closer")}function displayExpireAlert(){jQuery(".woo-cart-expire-modal-wrap").addClass("woo-cart-expire-modal-wrap-display")}function destroyAllEvidence(){document.cookie=wooCartExpiration.cookie_name+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",void 0!==window.cartPollID&&"undefined"!==window.cartPollID&&window.clearInterval(window.cartPollID),void 0!==window.cartTimeID&&"undefined"!==window.cartTimeID&&window.clearInterval(window.cartTimeID);var e=document.getElementById("woo-cart-timer-wrap-id");e&&e.remove()}jQuery(document).ready(function(r){r.fn.countdown=function(e,o){timerBlock=r(this),a=e.date,expireInvl=e.repeat,displayTimerValues(a,timerBlock),window.cartTimeID=setInterval(function(){displayTimerValues(a,timerBlock)},parseInt(expireInvl,10))};var e=wooCartExpiration.maybe_check,t=wooCartExpiration.interval,a=0,o=document.querySelector('meta[name="woo-cart-expiration"]');o?(a=o.getAttribute("content"),loadCartTimer(t),jQuery("#woo-cart-expire-countdown").countdown({date:a,repeat:1e3})):destroyAllEvidence(),"checkout"===e&&resetCookieAtCheckout(),"order"===e&&maybeRemoveTimer(),r(document.body).on("added_to_cart",function(e,o,r){displayTimerMarkup(t)}),r(document.body).on("removed_from_cart",function(e){maybeRemoveTimer()}),r(".woo-cart-expire-modal-wrap").on("click",".woo-cart-expire-modal-close",function(e){r(".woo-cart-expire-modal-block").fadeOut("slow",function(){maybeRemoveTimer(),r(".woo-cart-expire-modal-wrap").remove()})})});